import HelmBuilderRequirements from "../partials/helm/_helm-builder-requirements.mdx"
import BuilderAirgapIntro from "../partials/helm/_helm-cr-builder-airgap-intro.mdx"
import BuilderExample from "../partials/helm/_helm-cr-builder-example.mdx"
import AdditionalImages from "../partials/airgap/_additional-images.mdx"
import AdditionalImagesExample from "../partials/airgap/_additional-images-example.mdx"
import BuildDownload from "../partials/airgap/_build-download.mdx"

# Packaging Air Gap Bundles for Helm Charts

This topic describes how to package and build air gap bundles for releases that contain one or more Helm charts. This topic applies to applications deployed with Replicated KOTS.

## Overview

Air gap bundles (`.airgap`) contain the images needed to install and run a single release of your application in _air gap_ environments with no outbound internet access. You can build and download air gap bundles from the vendor portal **Release History** page.

To build an `.airgap` bundle for a release that contains one or more Helm charts, you must configure the [`builder`](/reference/custom-resource-helmchart-v2#builder) key in the KOTS HelmChart custom resource for each Helm chart in the release. In the `builder` key, you provide the minimum Helm values required to deploy the chart, as well as any upstream images that must be included in the air gap bundle. KOTS uses these values to template the given Helm chart when building the `.airgap` bundle for the release.

## Requirements and Recommendations

<HelmBuilderRequirements/>

## Configure the `builder` Key

The values in the `builder` key map to values in the corresponding Helm chart `values.yaml`. In the example below, `builder.postres.enabled` maps to `postres.enabled` in the Helm values:

```yaml
apiVersion: kots.io/v1beta2
kind: HelmChart
metadata:
  name: samplechart
spec:
  chart:
    name: samplechart
    chartVersion: 3.1.7
  builder:
    postgres:
      enabled: true 
```

The `builder` key contains static (hardcoded) values that override the corresponding Helm values when KOTS templates the Helm chart to build the `.airgap` bundle for the release. This means that you can set values in the `bubilder` key that are specific to air gap installations. For examples of common use cases for the `builder` key, see the sections below.

### Example: Set the Image Registry for Air Gap Installations

For air gap installations, it might be required to change the default image registry where certain images are pulled. You can use the `builder` key to do this by hardcoding the target values for the image registry, repository and tags for air gap installations, as shown in the example below:

```yaml
apiVersion: kots.io/v1beta2
kind: HelmChart
metadata:
  name: samplechart
spec:
  chart:
    name: samplechart
    chartVersion: 3.1.7
  builder:
    my-service:
      image:
      registry: index.docker.io
      repository: my-app
      tag: "1.0.2"    
```

### Example: Enable Conditional Resources

<BuilderExample/>

## Related Topics

* [Downloading Air Gap Bundles](/vendor/releases-download-airgap-bundles)
* [Build and Download the Application Bundle](/vendor/releases-download-airgap-bundles#air-gap-bundle)
* [builder](/reference/custom-resource-helmchart-v2#builder) in _HelmChart v2_