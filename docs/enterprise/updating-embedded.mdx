import UpdateAirGapAdm from "../partials/embedded-cluster/_update-air-gap-admin-console.mdx"
import UpdateAirGapCli from "../partials/embedded-cluster/_update-air-gap-cli.mdx"
import UpdateAirGapOverview from "../partials/embedded-cluster/_update-air-gap-overview.mdx"
import DoNotDowngrade from "../partials/embedded-cluster/_warning-do-not-downgrade.mdx"

# Performing Updates in Embedded Clusters (Beta)

This topic describes how to perform updates for [Replicated Embedded Cluster](/vendor/embedded-overview) installations.

:::note
Embedded cluster is in beta. If you are instead looking for information about Replicated kURL, see [Performing Updates in kURL Clusters](updating-kurl).
:::

## Overview

When you update an application installed with Embedded Cluster, you update both the application and the cluster infrastructure together, including Kubernetes, KOTS, and other components running in the cluster. There is no need or mechanism to update the infrastructure on its own.

When you deploy a new version, any changes to the cluster are deployed first. The Admin Console waits until the cluster is ready before updatng the application.

Any changes made to the Embedded Cluster Config, including changes to the Embedded Cluster version, Helm extensions, and unsupported overrides, trigger a cluster update.

When performing an upgrade with Embedded Cluster, the user is able to change the application config before deploying the new version. Additionally, the user's license is synced automatically. Users can also make config changes and sync their license outside of performing an update.

## Update

<DoNotDowngrade/>

To perform an update with Embedded Cluster:

1. In the Admin Console, go to the **Version history** tab.

   All versions available for upgrade are listed in the **Available Updates** section:

   ![Version history page](/images/ec-upgrade-version-history.png)

   [View a larger version of this image](/images/ec-upgrade-version-history.png)

1. Click **Deploy** next to the target version.

1. On the **Config** screen of the upgrade wizard, make any necessary changes to the configuration for the application. Click **Next**.

    ![Config screen in the upgrade wizard](/images/ec-upgrade-wizard-config.png)

    [View a larger version of this image](/images/ec-upgrade-wizard-config.png)

    :::note
    Any changes made on the **Config** screen of the upgrade wizard are not set until the new version is deployed.
    :::

1. On the **Preflight** screen, view the results of the preflight checks.

   ![Preflight screen in the upgrade wizard](/images/ec-upgrade-wizard-preflights.png)

   [View a larger version of this image](/images/ec-upgrade-wizard-preflights.png)

1. On the **Confirm** screen, click **Deploy**.

   ![Confirmation screen in the upgrade wizard](/images/ec-upgrade-wizard-confirm.png)

   [View a larger version of this image](/images/ec-upgrade-wizard-confirm.png)

   During cluster updates, the Admin Console can experience downtime and become unavailable if the Kubernetes version is updated. When viewing the Admin Console when the downtime occurs, the user sees a message that a cluster update is in progress and that the connection will resume after the Admin Console is available again:

   <img alt="Embedded cluster update in progress modal" src="/images/embedded-cluster-update-in-progress.png" width="400px"/>

   [View a larger version of this image](/images/embedded-cluster-update-in-progress.png)

## Perform Updates in Air Gap Clusters (Alpha)   

<DoNotDowngrade/>

<UpdateAirGapOverview/>

### From the Admin Console

To perform an update with Embedded Cluster in an air gap environment:

<UpdateAirGapAdm/>

### From the Command Line

<UpdateAirGapCli/>