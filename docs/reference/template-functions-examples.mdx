import IntegerComparison from "../partials/template-functions-examples/_integer-comparison.mdx"
import StringComparison from "../partials/template-functions-examples/_string-comparison.mdx"

# Examples

This topic provides examples of KOTS template function syntax for various common use cases.

## Comparisons

This section includes examples of doing different types of comparisons with KOTS template functions.

### Integer Comparison with Binary Operators

One common use case for comparing integer values is when you need to display different configuration options to your customers depending on values from their license. For example, the customer's license might include an entitlement that indicates the number of seats they are entitled to. In this case, it can be useful to conditionally display or hide certain fields on the KOTS admin console Config screen depending on the customer's team size.

<IntegerComparison/>

### String Comparison with Binary Operators

It can be useful to compare the rendered value of a template function against a string. For example, one common use case for comparing string values is to check the Kubernetes distribution of the cluster where an application is deployed.

<StringComparison/>

### Parse Boolean Values for Comparison

One common use case for using boolean values in comparisons is when you need to check that a given license field is present. In this case, the LicenseFieldValue template function will return the value of a specified license field. In order to evaluate the rendered value of the LicenseFieldValue template function as a boolean for the purpose of comparison, you need to use the [ParseBool](/reference/template-functions-static-context#parsebool). template function. ParseBool returns the boolean value represented by the string.

The following example shows a conditional statement that uses a logical `and` operator that evaluates to true when both the specified license field value is present and the specified config option is enabled.

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: test
data:
  option-1: '{{repl ConfigOptionEquals "option-1" "0"}}'
  license-field-1: '{{repl LicenseFieldValue "license-field-1" }}'
  when: '{{repl and (LicenseFieldValue "license-field-1" | ParseBool) (ConfigOptionEquals "option-1" "0")}}'
```

```yaml
data:
  option-1: "true"
  license-field-1: "false"
  when: "false"
```

### Logical `and` Comparison

The following example shows how to create a conditional statement using a logical `and` operator that evaluates to true when two target config options are both enabled.

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: test
data:
  option-1: '{{repl ConfigOptionEquals "option-1" "1"}}'
  option-2: '{{repl ConfigOptionEquals "option-2" "1"}}'
  when: '{{repl and (ConfigOptionEquals "option-1" "1") (ConfigOptionEquals "option-2" "1")}}'
```

```yaml
data:
  option-1: "true"
  license-field-1: "true"
  when: "true"
```

## Conditional Statements

Conditional statements can be used with KOTS template functions when you need different values to be rendered depending on a given condition. 

### If Else Statements

This section includes examples of single line and multi-line if else statements.

#### Single Line

The following example shows if else statements used in the KOTS HelmChart custom resource `value` field to render different values depending on if the user selected a load balancer or ingress controller as their preferred ingress type for the application. 

```yaml
apiVersion: kots.io/v1beta2
kind: HelmChart
metadata:
  name: determined
spec:
  chart:
    name: determined
    chartVersion: 0.23.0
  values:
    services:
      determined:
        enabled: true
        appName: ["determined"]
        type: 'repl{{ if ConfigOptionEquals "determined_ingress_type" "load_balancer" }} LoadBalancer repl{{ else }}ClusterIP repl{{ end }}'
        annotations: repl{{ ConfigOption "determined_load_balancer_annotations" | nindent 10 }}
        ports:
          http:
            enabled: true
            port: repl{{ if ConfigOptionEquals "determined_ingress_type" "load_balancer" }} repl{{ ConfigOption "determined_load_balancer_port" }} repl{{ else }} 8081 repl{{ end }}
            protocol: HTTP
            targetPort: 8081
```

```yaml
apiVersion: kots.io/v1beta1
kind: Config
metadata:
  name: config
spec:
  groups:
  - name: ingress_settings
    title: Ingress Settings
    description: Configure Ingress for Determined
    items:
    - name: determined_ingress_type
      title: Determined Ingress Type
      help_text: | 
        Select how traffic will ingress to the Determined appliction. The Ingress Controller option will create an Ingress object, 
        and Load Balancer will configure Determined's Kubernetes service to be of type LoadBalancer.
      type: select_one
      items:
      - name: ingress_controller
        title: Ingress Controller
      - name: load_balancer
        title: Load Balancer
      default: "ingress_controller"
      required: true
      when: 'repl{{ not IsKurl }}'
```

#### Multi-Line

The following example demonstrates a multi-line if else statement that renders the hostname for a private image registry depending on if a local registry is used and if the local registry has a namespace.

Multi-line if else statements can be useful for longer or more complex if else statements, which are easier to read when split across multiple lines.


```yaml
replicated-sdk: >-
  {{repl if HasLocalRegistry -}}
    {{repl if LocalRegistryNamespace -}}
      {{repl LocalRegistryHost }}/{{repl LocalRegistryNamespace }}/replicated-sdk:v1.0.0-beta.12
    {{repl else -}}
      {{repl LocalRegistryHost }}/replicated-sdk:v1.0.0-beta.12
    {{repl end -}}
  {{repl else -}}
    docker.io/replicated/replicated-sdk:v1.0.0-beta.12
  {{repl end -}}
```   

### Ternary Operators

Ternary operators are useful for tempalting statements where different values should be rendered depending on a given condition. A common use case for this is when templating the hostnames and namespaces for local image registries based on user-supplied values. 

#### Single Ternary Operator

For example, if the user configured a local registry and used the namespace `example-namespace`, then the template function `'{{repl HasLocalRegistry | ternary LocalRegistryNamespace "my-org" }}/mariadb'` evaluates to `example-namespace/mariadb`. If the user did not configure a local registry, then the template function evaluates to `my-org/maridb`.

```yaml
# kots.io/v1beta2 HelmChart custom resource

apiVersion: kots.io/v1beta2
kind: HelmChart
metadata:
  name: samplechart
spec:
  ...
  values:
    image:
      registry: '{{repl HasLocalRegistry | ternary LocalRegistryHost "proxy.replicated.com" }}'
      repository: '{{repl HasLocalRegistry | ternary LocalRegistryNamespace "proxy/my-app/quay.io/my-org" }}/nginx'
      tag: v1.0.1
```

#### Nested Ternary Operators

The following examples shows a similar use case in which multiple ternary operators are used to render the hostname for a local registry depending if a local registry is used, and if a namespace was supplied for the local registry:

```yaml
# kots.io/v1beta2 HelmChart custom resource

apiVersion: kots.io/v1beta2
kind: HelmChart
metadata:
  name: samplechart
spec:
  ...
  values:
    image:
      registry: {{repl LocalRegistryHost }}{{repl HasLocalRegistry | ternary ("/" + (LocalRegistryNamespace | default "")) "" }}{{repl HasLocalRegistry | ternary "" "/replicated" }}/replicated-sdk:v1.0.0-beta.12
```

## Formatting

This section includes examples of how to format the rendered output of KOTS template functions.

### Indentation

The following example shows a textarea input that allows a user to provide some custom Helm values.

```yaml
# KOTS HelmChart v2 custom resource
apiVersion: kots.io/v1beta2
kind: HelmChart
metadata:
  name: determined
spec:
  chart:
    name: determined
    chartVersion: 0.23.0
  values:
    ingresses:
      determined:
        enabled: repl{{ ConfigOptionEquals "determined_ingress_type" "ingress_controller" }}
        serviceName: determined
        annotations: repl{{ ConfigOption "determined_ingress_annotations" | nindent 10 }}
        hosts:
          - host: 'repl{{ ConfigOption "determined_ingress_host"}}'
            paths:
              - path: /
                pathType: Prefix
                service:
                  port: 8081
```

```yaml
# KOTS Config custom resource
apiVersion: kots.io/v1beta1
kind: Config
metadata:
  name: config
spec:
  groups:
  - name: ingress_settings
    title: Ingress Settings
    description: Configure Ingress for Determined
    items:
    - name: determined_ingress_type
      title: Determined Ingress Type
      help_text: | 
        Select how traffic will ingress to the Determined appliction. The Ingress Controller option will create an Ingress object, 
        and Load Balancer will configure Determined's Kubernetes service to be of type LoadBalancer.
      type: select_one
      items:
      - name: ingress_controller
        title: Ingress Controller
      - name: load_balancer
        title: Load Balancer
      default: "ingress_controller"
      required: true
      when: 'repl{{ not IsKurl }}'
    - name: determined_ingress_host
      title: Determined Hostname
      help_text: Hostname which will be used to access Determined
      type: text
      default: "determined.example.com"
      required: true
      when: 'repl{{ and (not IsKurl) (ConfigOptionEquals "determined_ingress_type" "ingress_controller") }}'
    - name: determined_ingress_annotations
      type: textarea
      title: Ingress Annotations
      help_text: See your ingress controllerâ€™s documentation for the required annotations.
      when: 'repl{{ and (not IsKurl) (ConfigOptionEquals "determined_ingress_type" "ingress_controller") }}'
```
### Print Formatted Data

The following example shows how to render a user-supplied custom annotation on an Ingress resource deployed by KOTS. In this example, the user supplied an ingress hostname on the admin console Config page, and that user-supplied hostname is used in a custom annotation applied to the Ingress resource.

This example uses `printf` to print formatted data, and the `%s` variable to format the value of the `"ingress_hostname"` configuration field as a string. This example also uses `| nindent 4` to indent the rendered value four spaces so that YAML is properly rendered at the time of deployment.

For more information about `printf` and `%s`, see [fmt](https://pkg.go.dev/fmt) in the Go documentation.

```yaml
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: example
  annotations:
    kots.io/placeholder: |-
      repl{{ printf "my.custom/annotation.ingress.hostname: %s" (ConfigOption "ingress_hostname") | nindent 4 }}
```