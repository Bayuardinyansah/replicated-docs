import AppInstallIntroAirGap from "../partials/install/_install-app-admin-console-intro-air-gap.mdx"
import IntroExisting from "../partials/install/_intro-existing.mdx"
import KotsAbout from "../partials/install/_kots-about.mdx"
import IntroAirGap from "../partials/install/_intro-air-gap.mdx"
import PrereqsExistingCluster from "../partials/install/_prereqs-existing-cluster.mdx"
import AirGapBundle from "../partials/install/_airgap-bundle-prereq.mdx"
import LicenseFile from "../partials/install/_license-file-prereq.mdx"
import DownloadKotsBundle from "../partials/install/_download-kotsadm-bundle.mdx"
import InstallCommandPrompts from "../partials/install/_kots-install-prompts.mdx"
import ContinueToInstall from "../partials/install/_continue-to-install-step.mdx"
import AppNameUI from "../partials/install/_placeholder-app-name-UI.mdx"
import InstallKotsCliAirGap from "../partials/install/_install-kots-cli-airgap.mdx"
import PushKotsImages from "../partials/install/_push-kotsadm-images.mdx"
import PlaceholderRoCreds from "../partials/install/_placeholder-ro-creds.mdx"
import KotsVersionMatch from "../partials/install/_kots-airgap-version-match.mdx"

# Air Gap Installation in Existing Clusters

<IntroExisting/>

<IntroAirGap/>

## About Private Registries

Air gapped networks must have a Docker image registry that is available inside the network. KOTS rewrites the application image names in all application manifests to read from the on-premises registry, and it re-tags and pushes the images to the on-premises registry. When authenticating to the registry, credentials with `push` permissions are required.

A single application expects to use a single namespace in the Docker image registry. The namespace name can be any valid URL-safe string, supplied at installation time. A registry typically expects the namespace to exist before any images can be pushed into it.

:::note
ECR does not use namespaces.
:::

## Prerequisites

Complete the following prerequisites:

<PrereqsExistingCluster/>

* Ensure that there is a compatible Docker image registry available inside the network. For more information about Docker registry compatibility, see [Private Registry Requirements](/enterprise/installing-general-requirements#private-registry-requirements).

<AirGapBundle/>

<LicenseFile/>

* <DownloadKotsBundle/>

## Install KOTS {#air-gap}

This procedure describes how to install KOTS in your existing cluster using the `kotsadm.tar.gz` air gap bundle.

<KotsAbout/>

To install KOTS:

1. <InstallKotsCliAirGap/>

    <KotsVersionMatch/>

1. <PushKotsImages/>

1. Install the KOTS Admin Console using the images that you pushed in the previous step:

   ```shell
   kubectl kots install APP_NAME \
     --kotsadm-registry REGISTRY_HOST \
     --registry-username RO-USERNAME \
     --registry-password RO-PASSWORD
   ```

   Replace:

    * `APP_NAME` with a name for the application. This is the unique name that KOTS will use to refer to the application that you install.
    <PlaceholderRoCreds/>

1. <InstallCommandPrompts/>

1. <ContinueToInstall/>    

## Install and Deploy the Application {#install-app}    

<AppInstallIntroAirGap/>

To install the application using the Admin Console:

1. Access the Admin Console on port 8800. If the port forward is active, go to [http://localhost:8800](http://localhost:8800) to access the Admin Console.

      If you need to reopen the port forward to the Admin Console, run the following command:

      ```shell
      kubectl kots admin-console -n NAMESPACE
      ```
      Replace `NAMESPACE` with the namespace where KOTS is installed.

1. Log in with the password that you created during installation.

1. Upload your license file.

1. Upload the `.airgap` application air gap bundle.

1. If there are configurations specific to the application, complete the fields on the configuration screen then click **Continue**. The required and optional configuration fields on this screen are used to build the final deployable Kubernetes manifests for the application.

   If the application vendor did not include any configuration options for the application, this screen does not display.

   ![Initial Config](/images/initial-config.png)

1. Complete the preflight checks. KOTS automatically runs preflight checks (conformance tests) against the target namespace and cluster to ensure that the environment meets the minimum requirements to support the application.

   * If there are no preflight check warnings or failures, continue with deployment.
   * If there are any preflight check warnings and failures:
      * Resolve the warnings and failures, and click **Re-run** to run the preflight checks again.
      * If there are no failures that prevent application deployment, you can choose to dismiss the preflight check warnings to continue.
        :::note
        Replicated recommends that you address any warnings or failures, rather than dismissing them. Preflight checks help ensure that your environment meets the requirements for application deployment.
        :::
      * If you are installing with minimal role-based access control (RBAC), KOTS recognizes if the preflight checks failed due to insufficient privileges.

        When this occurs, a kubectl CLI preflight command displays that lets you manually run the preflight checks. The Admin Console automatically displays the results of the preflight checks.

        ![kubectl CLI preflight command](/images/kubectl-preflight-command.png)

        [View a larger version of this image](/images/kubectl-preflight-command.png)

   After preflight checks are complete, KOTS deploys the Admin Console and the application, and the Admin Console dashboard opens:

   ![Graphs on the Admin Console dashboard](/images/kotsadm-dashboard-graph.png)