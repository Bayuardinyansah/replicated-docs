import PreflightSpec from "../partials/kots-lint-rules/_preflight-spec.mdx"
import ConfigSpec from "../partials/kots-lint-rules/_config-spec.mdx"
import TroubleshootSpec from "../partials/kots-lint-rules/_troubleshoot-spec.mdx"
import ApplicationSpec from "../partials/kots-lint-rules/_application-spec.mdx"
import ApplicationIcon from "../partials/kots-lint-rules/_application-icon.mdx"
import ApplicationStatusInformers from "../partials/kots-lint-rules/_application-statusInformers.mdx"
import InvalidTargetKOTS from "../partials/kots-lint-rules/_invalid-target-kots-version.mdx"
import InvalidMinKOTS from "../partials/kots-lint-rules/_invalid-min-kots-version.mdx"
import InvalidKubernetesInstaller from "../partials/kots-lint-rules/_invalid-kubernetes-installer.mdx"
import DeprecatedKubernetesInstallerVersion from "../partials/kots-lint-rules/_deprecated-kubernetes-installer-version.mdx"


# KOTS Lint Rules

This topic describes the rules for the KOTS lint service. The KOTS lint service lints the manifest files for applications packaged with Replicated to ensure that there are no YAML syntax errors, that all required manifest files are present in the release, and more.

The KOTS lint service runs automatically against releases that you create in the Replicated vendor portal, and displays any error or warning messages in the vendor portal UI.

To use the KOTS lint service to lint your application manifest files, you can run the replicated CLI `replicated release lint` command against the root directory of your application manifest files. You can also use the `--lint` flag when you create a release with the `replicated release create` command. For more information, see [release lint](/reference/replicated-cli-release-lint) and [release create](/reference/replicated-cli-release-create) in the _replicated CLI_ section.

### missing-kind-field

<table>
  <tr>
    <th>Description</th>
    <td>Require the <code>kind:</code> field in all files.</td>
  </tr>
  <tr>
    <th>Level</th>
    <td>Error</td>
  </tr>
  <tr>
    <th>Applies To</th>
    <td>All files</td>
  </tr>
  <tr>
    <th>Example</th>
    <td><p>Example of correct YAML for this rule:</p>
    <pre><code>
    kind: Config
    </code></pre>
    </td>
  </tr>
</table>


### missing-api-version-field

<table>
  <tr>
    <th>Description</th>
    <td>Require the <code>apiVersion:</code> field in all files.</td>
  </tr>
  <tr>
    <th>Level</th>
    <td>Error</td>
  </tr>
  <tr>
    <th>Applies To</th>
    <td>All files</td>
  </tr>
  <tr>
    <th>Example</th>
    <td><p>Example of correct YAML for this rule:</p>
    <pre><code>
    apiVersion: kots.io/v1beta1
    </code></pre>
    </td>
  </tr>
</table>


### preflight-spec

<table>
  <tr>
    <th>Description</th>
    <td><p>Require a custom resource manifest file with:</p>
      <p><code>kind: Preflight</code></p>
      <p>and one of the following:</p>
      <ul>
        <li><code>apiVersion: troubleshoot.replicated.com/v1beta1</code></li>
        <li><code>apiVersion: troubleshoot.sh/v1beta2</code></li>
      </ul>
    </td>
  </tr>
  <tr>
    <th>Level</th>
    <td>Warn</td>
  </tr>
  <tr>
    <th>Example</th>
    <td><p>Example of matching YAML for this rule:</p><PreflightSpec/></td>
  </tr>
</table>


### config-spec

<table>
  <tr>
    <th>Description</th>
    <td><p>Require a Config custom resource manifest file.</p>
      <p>Accepted value for <code>kind</code>: <code>Config</code></p>
      <p>Accepted value for <code>apiVersion</code>: <code>kots.io/v1beta1</code></p>
    </td>
  </tr>
  <tr>
    <th>Level</th>
    <td>Warn</td>
  </tr>
  <tr>
    <th>Example</th>
    <td><p>Example of matching YAML for this rule:</p><ConfigSpec/></td>
  </tr>
</table>

### troubleshoot-spec

<table>
  <tr>
    <th>Description</th>
    <td><p>Require a Troubleshoot manifest file.</p>
      <p>Accepted values for <code>kind</code>:</p>
      <ul>
        <li><code>Collector</code></li>
        <li><code>SupportBundle</code></li>
      </ul>
      <p>Accepted values for <code>apiVersion</code>:</p>
      <ul>
        <li><code>troubleshoot.replicated.com/v1beta1</code></li>
        <li><code>troubleshoot.sh/v1beta2</code></li>
      </ul>
    </td>
  </tr>
  <tr>
    <th>Level</th>
    <td>Warn</td>
  </tr>
  <tr>
    <th>Example</th>
    <td><p>Example of matching YAML for this rule:</p><TroubleshootSpec/></td>
  </tr>
</table>

### application-spec

<table>
  <tr>
    <th>Description</th>
    <td><p>Require an Application custom resource manifest file.</p>
      <p>Accepted value for <code>kind</code>: <code>Application</code></p>
    </td>
  </tr>
  <tr>
    <th>Level</th>
    <td>Warn</td>
  </tr>
  <tr>
    <th>Example</th>
    <td><p>Example of matching YAML for this rule:</p><ApplicationSpec/></td>
  </tr>
</table>


### application-icon

<table>
  <tr>
    <th>Description</th>
    <td>
      Require an application icon.
    </td>
  </tr>
  <tr>
    <th>Level</th>
    <td>Warn</td>
  </tr>
  <tr>
    <th>Applies To</th>
    <td>
      <p>Files with:</p>
      <ul>
        <li><code>kind: Application</code></li>
        <li><code>apiVersion: kots.io/v1beta1</code></li>
      </ul>
    </td>
  </tr>
  <tr>
    <th>Example</th>
    <td><p>Example of correct YAML for this rule:</p><ApplicationIcon/></td>
  </tr>
</table>


### application-statusInformers

<table>
  <tr>
    <th>Description</th>
    <td>
      Require statusInformers.
    </td>
  </tr>
  <tr>
    <th>Level</th>
    <td>Warn</td>
  </tr>
  <tr>
    <th>Applies To</th>
    <td>
      <p>Files with:</p>
      <ul>
        <li><code>kind: Application</code></li>
        <li><code>apiVersion: kots.io/v1beta1</code></li>
      </ul>
    </td>
  </tr>
  <tr>
    <th>Example</th>
    <td><p>Example of correct YAML for this rule:</p><ApplicationStatusInformers/></td>
  </tr>
</table>


### invalid-target-kots-version

<table>
  <tr>
    <th>Description</th>
    <td>
      <p>Require Application targetKotsVersion to use valid SemVer.
      See <a href="https://semver.org/">Semantic Versioning 2.0.0</a>.</p>
      <p>Accepts a <code>v</code> as an optional prefix, so both `1.0.0` and `v1.0.0` are valid.</p>
    </td>
  </tr>
  <tr>
    <th>Level</th>
    <td>Error</td>
  </tr>
  <tr>
    <th>Applies To</th>
    <td>
      <p>Files with:</p>
      <ul>
        <li><code>kind: Application</code></li>
        <li><code>apiVersion: kots.io/v1beta1</code></li>
      </ul>
    </td>
  </tr>
  <tr>
    <th>Example</th>
    <td><p>Example of correct YAML for this rule:</p><InvalidTargetKOTS/></td>
  </tr>
</table>


### invalid-min-kots-version

<table>
  <tr>
    <th>Description</th>
    <td>
      <p>Require Application minKotsVersion to use valid SemVer.
      See <a href="https://semver.org/">Semantic Versioning 2.0.0</a>.</p>
      <p>Accepts a <code>v</code> as an optional prefix, so both `1.0.0` and `v1.0.0` are valid.</p>
    </td>
  </tr>
  <tr>
    <th>Level</th>
    <td>Error</td>
  </tr>
  <tr>
    <th>Applies To</th>
    <td>
      <p>Files with:</p>
      <ul>
        <li><code>kind: Application</code></li>
        <li><code>apiVersion: kots.io/v1beta1</code></li>
      </ul>
    </td>
  </tr>
  <tr>
    <th>Example</th>
    <td><p>Example of correct YAML for this rule:</p><InvalidMinKOTS/></td>
  </tr>
</table>


### invalid-kubernetes-installer

<table>
  <tr>
    <th>Description</th>
    <td>
      <p>Enforce valid Kubernetes installer add-on versions.</p>
      <p>Add-ons included in the Kubernetes installer must pin specific versions rather than <code>latest</code> or x-ranges (1.2.x).</p>
    </td>
  </tr>
  <tr>
    <th>Level</th>
    <td>Error</td>
  </tr>
  <tr>
    <th>Applies To</th>
    <td>
    <p>Files with <code>kind: Installer</code> and one of the following values for <code>apiVersion</code>:</p>
    <ul>
      <li><code>cluster.kurl.sh/v1beta1</code></li>
      <li><code>kurl.sh/v1beta1</code></li>
    </ul>
    </td>
  </tr>
  <tr>
    <th>Example</th>
    <td><InvalidKubernetesInstaller/></td>
  </tr>
</table>


### deprecated-kubernetes-installer-version

<table>
  <tr>
    <th>Description</th>
    <td>
      <p>Disallow using the deprecated Kubernetes installer <code>apiVersion</code>.</p>
      <p><code>kurl.sh/v1beta1</code> is deprecated. Use <code>cluster.kurl.sh/v1beta1</code> instead.</p>
      </td>
  </tr>
  <tr>
    <th>Level</th>
    <td>Warn</td>
  </tr>
  <tr>
    <th>Applies To</th>
    <td>
    <p>Files with:</p>
    <ul>
      <li><code>kind: Installer</code></li>
      <li><code>apiVersion: kurl.sh/v1beta1</code></li>
    </ul>
    </td>
  </tr>
  <tr>
    <th>Example</th>
    <td><DeprecatedKubernetesInstallerVersion/></td>
  </tr>
</table>


### duplicate-kots-kind

Disallow duplicate KOTS kinds.

A release can only include one of each kind of resource. This rule disallows inclusion of more than
one file with:
- the same `kind` and `apiVersion`
- `kind: Troubleshoot` and any Troubleshoot `apiVersion`
- `kind: Installer` and any Installer `apiVersion`

Level: “error”

Applies to all files.


### invalid-helm-release-name

Enforce valid `releaseName` on HelmChart CRD.

`spec.chart.releaseName` should:
- begin and end with a lowercase letter or number
- contain only lowercase letters, numbers, periods, and hyphens (`-`)
- have a lowercase letter or number between any two symbols (periods or hypens)

Level: “warn”

Applies to `apiVersion`:
 - `kots.io/v1beta1`

Applies to `kind`:
 - `HelmChart`

Example of **correct** yaml for this rule:

```yaml
apiVersion: kots.io/v1beta1
kind: HelmChart
spec:
  chart:
    releaseName: samplechart-release-1
```


### duplicate-helm-release-name

Enforce unique `releaseName` across all HelmChart CRDs.

Level: “error"

Applies to `apiVersion`:
 - `kots.io/v1beta1`

Applies to `kind`:
 - `HelmChart`


### replicas-1

Notify if any spec has `replicas` set to `1`.

Level: "info"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
spec:
  replicas: 1
```


### privileged

Notify if any spec has `privileged` set to `true`.

Level: "info"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
spec:
  privileged: true
```


### allow-privilege-escalation

Notify if any spec has `allowPrivilegeEscalation` set to `true`.

Level: "info"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
spec:
  allowPrivilegeEscalation: true
```


### container-image-latest-tag

Notify if any spec has a container image tag appended with `:latest`.

Level: "info"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
spec:
  containers:
    - image: nginx:latest
```


### container-image-local-image-name

Disallow a spec having a container image tag that includes "LocalImageName".

Level: "error"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
spec:
  containers:
    - image: LocalImageName
```


### container-resources

Notify if a spec container has no `resources` field.

Level: "info"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
spec:
  containers:
    - name: nginx
      # note the lack of a resources field
```


### container-resource-limits

Notify if a spec container has no `resources.limits` field.

Level: "info"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
spec:
  containers:
    - name: nginx
      resources:
        requests:
          memory: '32Mi'
          cpu: '100m'
        # note the lack of a limit field
```


### container-resource-requests

Notify if a spec container has no `resources.requests` field.

Level: "info"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
spec:
  containers:
    - name: nginx
      resources:
        limits:
          memory: '256Mi'
          cpu: '500m'
        # note the lack of a requests field
```


### resource-limits-cpu

Notify if a spec container has no `resources.limits.cpu` field.

Level: "info"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
spec:
  containers:
    - name: nginx
      resources:
        limits:
          memory: '256Mi'
          # note the lack of a cpu field
```


### resource-limits-memory

Notify if a spec container has no `resources.limits.memory` field.

Level: "info"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
spec:
  containers:
    - name: nginx
      resources:
        limits:
          cpu: '500m'
          # note the lack of a memory field
```


### resource-requests-cpu

Notify if a spec container has no `resources.requests.cpu` field.

Level: "info"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
spec:
  containers:
    - name: nginx
      resources:
        requests:
          memory: '32Mi'
          # note the lack of a memory field
```


### resource-requests-memory

Notify if a spec container has no `resources.requests.memory` field.

Level: "info"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
spec:
  containers:
    - name: nginx
      resources:
        requests:
          cpu: '100m'
          # note the lack of a memory field
```


### volumes-host-paths

Notify if a spec volume has defined a `hostPath`.

Level: "info"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
spec:
  volumes:
    - hostPath:
      path: /data
```

### volume-docker-sock

Notify if a spec volume has `hostPath` set to `/var/run/docker.sock`.

Level: "info"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
spec:
  volumes:
    - hostPath:
      path: /var/run/docker.sock
```


### hardcoded-namespace

Notify if any file has a `metadata.namespace` set to a static value.

We strongly recommended not specifying a namespace to allow maximum flexibility when deploying into end user environments.

Level: "info"

Applies to all files.

Related docs:
- [Managing Application Namespaces](/vendor/namespaces)

Example of **matching** yaml for this rule:

```yaml
metadata:
  name: spline-reticulator
  namespace: graphviz-pro
```


### may-contain-secrets

Notify if any file may contain secrets.

Level: "info"

Applies to all files.

Example of **matching** yaml for this rule:

```yaml
data:
    ENV_VAR_1: "y2X4hPiAKn0Pbo24/i5nlInNpvrL/HJhlSCueq9csamAN8g5y1QUjQnNL7btQ=="
```


### config-option-invalid-type

Enforce valid types for Config items.

Level: "error"

Applies to all files.

Related docs:
- [Config Item types](/reference/custom-resource-config#available-item-types)

Example of **correct** yaml for this rule:

```yaml
spec:
  groups:
  - name: authentication
    title: Authentication
    description: Configure application authentication below.
    - name: group_title
      title: Group Title
      items:
      - name: http_enabled
        title: HTTP Enabled
        type: bool # bool is a valid type
```

Example of **incorrect** yaml for this rule:

```yaml
spec:
  groups:
  - name: authentication
    title: Authentication
    description: Configure application authentication below.
    - name: group_title
      title: Group Title
      items:
      - name: http_enabled
        title: HTTP Enabled
        type: unknown_type # unknown_type is not a valid type
```

### repeat-option-missing-template

Disallow repeating Config item with undefined `item.templates`.

Level: "error"

Applies to all files.

Related docs:
- [Repeatable Item Template Targets](/reference/custom-resource-config#template-targets)

Example of **correct** yaml for this rule:

```yaml
spec:
  groups:
    - name: ports
      items:
      - name: service_port
        title: Service Port
        type: text
        repeatable: true
        templates:
        - apiVersion: v1
          kind: Service
          name: my-service
          namespace: my-app
          yamlPath: 'spec.ports[0]'
        - apiVersion: v1
          kind: Service
          name: my-service
          namespace: my-app
```


### repeat-option-missing-valuesByGroup

Disallow repeating Config item with undefined `item.valuesByGroup`.

Level: "error"

Applies to all files.

Related docs:
- [Repeatable Items](/reference/custom-resource-config#repeatable-items)

Example of **correct** yaml for this rule:

```yaml
spec:
  groups:
    - name: ports
      items:
      - name: service_port
        title: Service Port
        type: text
        repeatable: true
        valuesByGroup:
          ports:
            port-default-1: "80"
```


### repeat-option-malformed-yamlpath

Enforce ConfigOption `yamlPath` ending with square brackets denoting index position.

Level: "error"

Applies to all files.

Related docs:
- [Repeatable Item Template Targets](/reference/custom-resource-config#template-targets)

Example of **correct** yaml for this rule:

```yaml
spec:
  groups:
    - name: ports
      items:
      - name: service_port
        yamlPath: 'spec.ports[0]'
```


### config-option-password-type

Require ConfigOption items with names including `password`, `secret`, or `token` to have `type` set to `password`.

Level: "warn"

Applies to all files.

Example of **correct** yaml for this rule:

```yaml
spec:
  groups:
    - name: ports
      items:
      - name: my_secret
        type: password
```


### config-option-not-found

Require all used `ConfigOption`s to be defined in `Config` yaml.

Level: "warn"

Applies to all files.


### config-option-is-circular

Enforce `ConfigOption`s do not reference themselves.

Level: "error"

Applies to `apiVersion`:
 - `kots.io/v1beta1`

Applies to `kind`:
 - `Config`

Example of **incorrect** yaml for this rule:

```yaml
spec:
  groups:
  - name: example_settings
    items:
    - name: example_default_value
      type: text
      value: repl{{ ConfigOption "example_default_value" }}
```


### config-option-not-repeatable

Enforce sub-templated `ConfigOption` must be repeatable.

Level: "error"

Applies to all files.


### config-option-when-is-invalid

Enforce valid `ConfigOption.when`.

Level: "error"

Applies to `apiVersion`:
 - `kots.io/v1beta1`

Applies to `kind`:
 - `Config`

Related docs:
- [Config Properties - `when`](/reference/custom-resource-config#when)
