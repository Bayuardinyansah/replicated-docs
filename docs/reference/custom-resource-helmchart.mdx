import VersionLimitation from "../partials/helm/_helm-version-limitation.mdx"
import HelmBuilderRequirements from "../partials/helm/_helm-builder-requirements.mdx"
import Chart from "../partials/helm/_helm-cr-chart.mdx"
import ChartName from "../partials/helm/_helm-cr-chart-name.mdx"
import ChartVersion from "../partials/helm/_helm-cr-chart-version.mdx"
import ChartReleaseName from "../partials/helm/_helm-cr-chart-release-name.mdx"
import HelmUpgradeFlags from "../partials/helm/_helm-cr-upgrade-flags.mdx"
import Values from "../partials/helm/_helm-cr-values.mdx"
import Weight from "../partials/helm/_helm-cr-weight.mdx"
import Exclude from "../partials/helm/_helm-cr-exclude.mdx"
import OptionalValues from "../partials/helm/_helm-cr-optional-values.mdx"
import OptionalValuesWhen from "../partials/helm/_helm-cr-optional-values-when.mdx"
import OptionalValuesRecursiveMerge from "../partials/helm/_helm-cr-optional-values-recursive-merge.mdx"
import Namespace from "../partials/helm/_helm-cr-namespace.mdx"
import Intro from "../partials/helm/_helm-cr-intro.mdx"
import BuilderAirgapIntro from "../partials/helm/_helm-cr-builder-airgap-intro.mdx"
import BuilderExample from "../partials/helm/_helm-cr-builder-example.mdx"


# HelmChart v1

The HelmChart v1 custom resource applies to the native Helm and Replicated Helm installations. For more information, see [Supporting Native Helm and Replicated Helm](/vendor/helm-release).

<Intro/>

## Example

The following is an example manifest file for the HelmChart v1 custom resource:

```yaml
apiVersion: kots.io/v1beta1
kind: HelmChart
metadata:
  name: samplechart
spec:
  # chart identifies a matching chart from a .tgz
  chart:
    name: samplechart
    chartVersion: 3.1.7
    releaseName: samplechart-release-1

  exclude: "repl{{ ConfigOptionEquals `include_chart` `include_chart_no`}}"

  # helmVersion identifies the Helm Version used to render the chart. Default is v3.
  helmVersion: v3

  # useHelmInstall identifies whether this Helm chart will use the
  # Replicated Helm installation (false) or native Helm installation (true). Default is false.
  # Native Helm installations are only available for Helm v3 charts.
  useHelmInstall: true

  # weight determines the order that charts with "useHelmInstall: true" are applied, with lower weights first.
  weight: 42

  # helmUpgradeFlags specifies additional flags to pass to the `helm upgrade` command.
  helmUpgradeFlags:
    - --skip-crds
    - --no-hooks
    - --timeout
    - 1200s
    - --history-max=15

  # values are used in the customer environment, as a pre-render step
  # these values will be supplied to helm template
  values:
    postgresql:
      enabled: repl{{ ConfigOptionEquals `postgres_type` `embedded_postgres`}}

  optionalValues:
    - when: "repl{{ ConfigOptionEquals `postgres_type` `external_postgres`}}"
      recursiveMerge: false
      values:
        postgresql:
          postgresqlDatabase: "repl{{ if ConfigOptionEquals `postgres_type` `external_postgres`}}repl{{ ConfigOption `external_postgres_database`}}repl{{ end}}"
          postgresqlUsername: "repl{{ if ConfigOptionEquals `postgres_type` `external_postgres`}}repl{{ ConfigOption `external_postgres_username`}}repl{{ end}}"
          postgresqlHost: "repl{{ if ConfigOptionEquals `postgres_type` `external_postgres`}}repl{{ ConfigOption `external_postgres_host`}}repl{{ end}}"
          postgresqlPassword: "repl{{ if ConfigOptionEquals `postgres_type` `external_postgres`}}repl{{ ConfigOption `external_postgres_password`}}repl{{ end}}"
          postgresqlPort: "repl{{ if ConfigOptionEquals `postgres_type` `external_postgres`}}repl{{ ConfigOption `external_postgres_port`}}repl{{ end}}"

  # namespace allows for a chart to be installed in an alternate namespace to
  # the default
  namespace: samplechart-namespace

  # builder values provide a way to render the chart with all images
  # and manifests. this is used in Replicated to create `.airgap` packages
  builder:
    postgresql:
      enabled: true
```

## chart

<Chart/>

### chart.name

<ChartName/>

### chart.chartVersion

<ChartVersion/>

### chart.releaseName

<ChartReleaseName/>

## helmVersion

Identifies the Helm Version used to render the chart. Acceptable values are `v2` or `v3`. `v3` is the default when no value is specified, and `v3` is required for native Helm installations.

:::note
<VersionLimitation/>
:::

## useHelmInstall

Identifies whether this Helm chart will use the Replicated Helm installation (`false`) or native Helm installation (`true`). Replicated recommends that you set this to `true` because native Helm is the preferred method. **Default:** `false`

Native Helm can only be set for new charts. Modifying this flag in existing charts for existing applications is not supported because charts installed with Replicated Helm cannot be migrated to native Helm. However, you can add native Helm charts to an existing release that already uses Replicated Helm. Each chart is installed using the specified installation method for that chart, indicated by the value of the `useHelmInstall` flag.

Native Helm installations always deploy using Helm v3.

## weight

<Weight/>

## helmUpgradeFlags

:::note
`helmUpgradeFlags` is available in the app manager v1.75.0 and later.
:::

<HelmUpgradeFlags/>

## values

<Values/>

## exclude

<Exclude/>

## optionalValues

<OptionalValues/>

### optionalValues[].when

<OptionalValuesWhen/>

### optionalValues[].recursiveMerge

:::note
`recursiveMerge` is available in the app manager v1.38.0 and later.
:::

<OptionalValuesRecursiveMerge/>

## namespace

<Namespace/>

## builder

<BuilderAirgapIntro/>

<HelmBuilderRequirements/>

**Example:**

<BuilderExample/>