import PrerequisitesWorkflows from "../partials/getting-started/_prerequisites-workflows.mdx"
import HelmInstallRequirements from "../partials/helm/_helm-install-requirements.mdx"
import FeatureFlag from "../partials/helm/_feature-flag.mdx"
import PromoteUnstable from "../partials/releases/_promote-unstable.mdx"
import LicenseCreate from "../partials/releases/_license-create.mdx"
import ImageRegistryConnect from "../partials/releases/_image-registry-connect.mdx"
import TestDev from "../partials/releases/_test-dev.mdx"
import KurlInstaller from "../partials/releases/_kurl-installer.mdx"
import AddFunctionality from "../partials/releases/_add-functionality.mdx"

# KOTS Release Workflows

This topic provides prerequisites and workflows for creating a Replicated KOTS release for your application with and without the Replicated SDK.

## About Releasing your Application

A KOTS release for your application can include a set of standard Kubernetes manifests, Helm charts, or Kubernetes Operators. (While an operator is technically deployed either using plain Kubernetes manifests or a Helm chart, we list it separately because of the advanced image management work needed to effectively deliver Operators into customer environments.) 

In addition to your application files, a release also includes [Replicated custom resources](/reference/custom-resource-about) that are used to invoke various Replicated KOTS functions.

After you create the first release for your application, you continue the process of authoring, testing, iterating on, and accepting a set of files for release to your customers. Replicated recommends that you create and test releases for your application in small iterations before sharing a release with your customers. To begin, see [Prerequisites](#prerequisites) below.

If you have questions about these workflows, you can post a question on our [Community site](https://community.replicated.com/).

## Supported Installation Types

KOTS is the Replicated installer available to vendors with KOTS entitlements. KOTS provides support for installations on:

- Existing clusters in online and air gap environments
- Embedded clusters provisioned by kURL with the KOTS add-on on virtual machines or bare metal servers

KOTS supports installation in online and air gap environments.

If your application uses Helm charts, you can use a single release to support the KOTS installation and the Helm CLI installation methods. 
If you to add the the Helm installation method with the Replicated SDK features to your KOTS release, see [Helm with SDK Release Workflow](helm-release).

## Prerequisites

<PrerequisitesWorkflows/>

<!--Additionally, supporting Helm installations has the following requirements:

<HelmInstallRequirements/>

* <FeatureFlag/>

## KOTS Releases with Helm and the SDK

**Audience:** The audiences for this workflow are:

  - Existing vendors who are using KOTS and want to support Helm installations
  - New vendors who want to use KOTS, Helm charts, and support Helm installations

When you create a KOTS release with Helm charts, you get the benefit of providing customers with the KOTS installer and admin console. However, you might need to provide some customers with the ability to install using the Helm CLI.
You can support Helm CLI installations in a KOTS release. Optionally, you can add the SDK to get the benefits of the SDK features with Helm installations, including the ability to use the proxy service for license validation without exposing your registry credentials.

Complete the following procedures to create and test a KOTS release that includes the SDK:

1. (Recommended) Familiarize yourself by using the SDK in integration mode. This lets you test the SDK API with mock data in a local environment without making changes to your release in the vendor portal. See [Developing Against the SDK API](replicated-sdk-development).

  Integration mode testing is a fast, reliable way to test and iterate every time you create or update a release, before committing changes in the vendor portal and performing full testing.

1. Add the SDK as a dependency to your Helm chart and package the Helm chart. See [Declare the SDK as a Dependency](replicated-sdk-using#declare-the-sdk-as-a-dependency) in _Using the SDK with Your Application (Beta)_.

1. Create an application or use an existing application in the vendor portal, and create a new release. See [Using the Vendor Portal](replicated-sdk-using#using-the-vendor-portal) in _Using the SDK with Your Application (Beta)_.

1. Add custom resources to add KOTS functionality to the KOTS release. See [Add KOTS Custom Resources](custom-resources).

1. <KurlInstaller/>

1. <PromoteUnstable/>

1. <LicenseCreate/>

1. <ImageRegistryConnect/>

1. Test your installation:

    - Helm Installation: See [Installing an Application with Helm (Beta)](install-with-helm)
    - KOTS and kURL Installation: See [About Installing an Application](installing-overview)

1. Validate that telemetry is showing up for the customer instance. Click through to the instance details and review the events. See [About Instance and Event Data](instance-insights-event-data).

After you install the first release for your application, return to the vendor portal to create a new release with additional functionality. For more information, see:

- [Add SDK Functionality](sdk-functionality-add)
- [Add KOTS Custom Resources](custom-resources) 
-->

## KOTS Release Workflow

**Audience:** Vendors who are new to using KOTS.

:::note
To use Kubernetes Operators, you skip connecting to a private registry and skip creating a Configuration screen in the admin console. You can use any of the other packaging functions. For more information, see [Package the Kubernetes Operator Application](operator-packaging-about).
:::

Complete the following procedures to create and test your first release:

1. Push your images to the Replicated registry if you plan to host your images on that registry. See [Push Images to the Replicated Registry](packaging-private-images#push-images-to-the-replicated-private-registry) in _Connecting to an Image Registry_.

    If you are using a different registry option, skip this step and proceed to the next step.

1. Create an application in the Replicated vendor portal. See [Creating a Release](releases-creating-releases#create-a-release) in _Managing Releases with the Vendor Portal_

1. Create a release:

  - For Helm charts, see [Create a Release with Your Helm Chart for KOTS](helm-release).
  - For Kubernetes standard manifests or Operators, see [Create a Release](releases-creating-releases#create-a-release) in _Managing Releases with the Vendor Portal_.

1. If you are using private images, either connect to an external private registry or update the image tags to point to the Replicated registry. See [Connecting to an Image Registry](packaging-private-images).

1. <KurlInstaller/>

1. <PromoteUnstable/>

1. <LicenseCreate/>

1. <TestDev/>

  After you install the first release for your application, return to the vendor portal to create a new release with additional functionality. For more information, see [Add KOTS Custom Resources](custom-resources). 

## Add Custom Resources

You use Replicated custom resources to add functionality to KOTS releases. Custom resources are YAML files that you add to releases, depending on which options you want to use. 

Custom resources are packaged as part of the application release but are not deployed to the cluster. Instead, custom resources control the application experience. For example, custom resources let you define the user-facing Config screen, brand the admin console, and configure preflight check and support bundles. For more information and a list of available custom resources, see [About Custom Resources](/reference/custom-resource-about) in _Reference_.

<AddFunctionality/> 

The following table gives a suggested order to add KOTS functionality, but you can add functionality in any order, and as needed. The functionality described in the table can be used with Kubernetes Operators, except where noted.

<table>
  <tr>
    <th width="30%">Functionality</th>
    <th width="70%">Description</th>
  </tr>
  <tr>
  <td>Configuration Screen</td>
      <td><p>Create a Configuration screen in the admin console to collect required and optional configuration values from your users. See <a href="admin-console-customize-config-screen">Creating and Editing Configuration Fields</a>.</p><p><strong>Note:</strong> This feature does not apply to Kubernetes Operators.</p></td>
  </tr>
  <tr>
    <td>Status Informers</td>
    <td>Status informers are supported Kubernetes resources that KOTS watches for changes in state. Add one or more status informers to display the current application status for your users on the admin console dashboard. Additionally, status informers allow you to get insights on the status of application instances running in customer environments. See <a href="admin-console-display-app-status">Adding Resource Status Informers</a>.</td>
  </tr>
  <tr>
    <td>Preflight Checks and Support Bundles</td>
    <td>Define preflight checks to test for system compliance during the installation process and reduce the number of support escalations. <br></br><br></br>Enable support bundles to collect and analyze troubleshooting data from your customers' clusters to help you diagnose problems with application deployments. See <a href="preflight-support-bundle-about">About Preflight Checks and Support Bundles</a></td>
  </tr>
  <tr>
    <td>Kubernetes Installers</td>
    <td>Create a Kubernetes installer specification file (or add to an existing specification) so that your customers can provision a cluster in their VM or bare metal server. See <a href="packaging-embedded-kubernetes">Creating a Kubernetes Installer</a>.</td>
  </tr>
  <tr>
    <td>Backup and Restore (Snapshots)</td>
    <td>Enable snapshots so that end users can back up and restore their application data. See <a href="snapshots-configuring-backups">Configuring Backup and Restore</a>.</td>
  </tr>
  <tr>
    <td>KOTS Annotations</td>
    <td>
    <p>Add annotations to manage resources and objects in your release:</p>
    <ul>
      <li>Include and exclude resources, such as an embedded database, based on a customers' license entitlements or configuration choices. See <a href="packaging-include-resources">Including Optional and Conditional Resources</a>.</li>
      <li>Add a delete hook policy to delete jobs after they successfully complete. See <a href="packaging-cleaning-up-jobs">Cleaning Up Kubernetes Jobs</a>.</li>
    </ul>
    </td>
  </tr>
  <tr>
    <td>Admin Console and Download Portal Customization</td>
    <td>Customize the branding and application icon displayed in the admin console and the download portal. You can also customize the functionality of the admin console, such as adding ports and port forwarding, adding custom graphs, and more. See the <a href="admin-console-customize-app-icon">Admin Console and Download Portal Customization</a> section.</td>
  </tr>
  <tr>
    <td>Minimum and Target KOTS Versions</td>
    <td>
    <p>Specify the minimum or target versions of KOTS that are required for users to install your application release. See <a href="packaging-kots-versions">Setting Minimum and Target Versions for KOTS</a>.</p>
    </td>
  </tr>
</table>
