import SDKOverview from "../partials/replicated-sdk/_overview.mdx"
import BestPractices from "../partials/onboarding/_best-practices.mdx"
import Community from "../partials/onboarding/_community.mdx"
import Prerequisites from "../partials/onboarding/_prerequisites.mdx"
import PackageSdk from "../partials/onboarding/_package-sdk.mdx"
import Preflights from "../partials/onboarding/_preflights.mdx"
import SupportBundles from "../partials/onboarding/_support-bundles.mdx"
import DependencyYaml from "../partials/replicated-sdk/_dependency-yaml.mdx"
import CiCd from "../partials/onboarding/_ci-cd.mdx"
import CustomMetrics from "../partials/onboarding/_custom-metrics.mdx"
import CustomChannels from "../partials/onboarding/_custom-channels.mdx"
import CustomDomains from "../partials/onboarding/_custom-domains.mdx"

# KOTS and Embedded Cluster Onboarding 

This topic describes how to onboard applications that will support installation with Replicated KOTS, Replicated Embedded Cluster, and the Helm CLI.

If your application will support Helm CLI installations only, see [Helm CLI-Only Onboarding](/vendor/replicated-onboarding).

## Before You Begin

This section includes guidance and prerequisites to review before you begin onboarding your application.

### Prerequisites

<Prerequisites/>

* Ensure that you have kubectl access to a cluster.

* Ensure that you have access to a VM that meets the requirements for Embedded Cluster.

### Best Practices and Recommendations

<BestPractices/>

### Getting Help from the Community

<Community/>

## Onboard

### Task 0: Create An Application

Create an application in the Vendor Portal. See [Create an Application](/vendor/vendor-portal-manage-app#create-an-application).

### Task 0: Connect Your Image Registry

Add credentials for your image registry to the Vendor Portal. This will allow you to enable the Replicated proxy service in a later step so that you can grant proxy access to application images without exposing registry credentials to your customers.

For more information, see [Connecting to an External Registry](/vendor/packaging-private-images).

### Task 0: Create and Install the Initial Release

As part of the initial release for your application, you will add your Helm chart archive, KOTS HelmChart custom resource, and Embedded Cluster Config to the release.

To create and install the initial release for your application:

1. <PackageSdk/>

   <DependencyYaml/>   

1. Configure the KOTS HelmChart Custom Resource:

    The KOTS HelmChart custom resource is required to install Helm charts with KOTS and Embedded Cluster. It provides instructions to KOTS about how to deploy the given Helm chart.

    To configure the KOTS HelmChart Custom Resource, complete the workflow in [Configuring the HelmChart Custom Resource](helm-native-v2-using).

    :::note
    If your application is deployed as multiple Helm charts, add a separate HelmChart custom resource for each chart.
    :::

1. Configure the Embedded Cluster Config:

    Create an Embedded Cluster Config to support installations on VMs or bare metal servers with the Replicated Embedded Cluster installer.

    ```yaml
    apiVersion: embeddedcluster.replicated.com/v1beta1
    kind: Config
    spec:
      version: 1.8.0+k8s-1.29
    ```
    See the Embedded Cluster GitHub repo to find the latest version.

    For more information, see [Using Embedded Cluster](/vendor/embedded-overview).

1. Promote the release to the Unstable channel.

1. Install the release:

   1. Install with Embedded Cluster in a VM:

   1. Install in an existing cluster with KOTS:

### Task 0: Customize the KOTS Admin Console {#admin-console}

After successfully installing your initial release, add the KOTS Application custom resource and the Kubernetes SIG Application custom resource in order to customize the Admin Console experience for your application.

#### Task 0a: Add Application Name, Icon, and Status Informers

To Add Application Name, Icon, and Status Informers:

1. In a new release, add the KOTS Application custom resource to add an application name, icon, and status informers.

   **Example:**

    ```yaml
    apiVersion: kots.io/v1beta1
    kind: Application
    metadata:
      name: gitea
    spec:
      title: Gitea
      icon: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.png
      statusInformers:
        - deployment/gitea
    ```
    For more information, see:
    * [Application](/reference/custom-resource-application)
    * [Enabling and Understanding Application Status](/vendor/insights-app-status)

1. Install the release to test your changes.

#### Task 0b: Add Application Links to the Dashboard

1. In a new release, configure the Kubernetes SIG Application custom resource to add one or more links to your application on the Admin Console dashboard.

    **Example:**

    ```yaml
    apiVersion: app.k8s.io/v1beta1
    kind: Application
    metadata:
      name: "gitea"
    spec:
      descriptor:
        links:
          - description: Open App
            url: ""
    ``` 

    For more information, see [Adding Application Links to the Dashboard](/vendor/admin-console-adding-buttons-links).

1. Install the release to test your changes.

### Task 0: Set Up the Admin Console Config Screen and Map to Helm Values

The KOTS Admin Console config screen is used to collect required and optional application configuration values from your users. User-supplied values provided on the config screen can be mapped to your Helm values.

To set up the Admin Console Config screen for your application:

1. In a new release, add the KOTS Config custom resource. Include groups and items in the KOTS Config custom resource based on the values that you need to collect from users.

    **Example:**

    ```yaml
    apiVersion: kots.io/v1beta1
    kind: Config
    metadata:
      name: my-application
    spec:
      groups:
        - name: example_group
          title: Example Group
          items:
            - name: example_item
              title: Example Item
              type: text
              default: "Hello World"
    ```

    For more information, see:
    * [Creating and Editing Configuration Fields](/vendor/admin-console-customize-config-screen) 
    * [Using Conditional Statements in Configuration Fields](/vendor/config-screen-conditional)  
    * [Config](/reference/custom-resource-config)  

1. Install the release so that you can see the config screen in the Admin Console.

1. In a new release, configure the `values` key in the KOTS HelmChart custom resource to map the fields in the KOTS Config custom resource to your Helm values.

   For more information, see:
   * [Mapping User-Supplied Values](/vendor/config-screen-map-inputs).
   * [Tutorial: Set Helm Chart Values with KOTS](/vendor/tutorial-config-setup).
   * [`values`](/reference/custom-resource-helmchart-v2#values) in _HelmChart v2_

1. Install the new release to test your changes.

1. Continue to create and test new releases with new config fields until you are ready to move on to the next task.

### Task 0: Add Preflight Checks and Support Bundles

Preflight checks and support bundles are provided by the Troubleshoot open source project, which is maintained by Replicated. Troubleshoot is a kubectl plugin that provides diagnostic tools for Kubernetes applications. For more information, see the open source [Troubleshoot](https://troubleshoot.sh/docs/collect/) documentation.

Preflight checks and support bundles analyze data from customer environments to provide insights that help users to avoid or troubleshoot common issues with an application:
* **Preflight checks** run before an application is installed to check that the customer environment meets the application requirements.
* **Support bundles** collect troubleshooting data from customer environments to help users diagnose problems with application deployments.

#### Task 0a: Define Preflights 

<Preflights/>

#### Task 0b: Add the Default Support Bundle Spec

<SupportBundles/>

### Task 0: Add Support for Air Gap

KOTS and Embedded Cluster both support installations in _air gap_ environments with no outbound internet access.

For information, see:
* [Packaging Air Gap Bundles for Helm Charts](/vendor/helm-packaging-airgap-bundles)
* [Building Air Gap Bundles](/vendor/releases-download-airgap-bundles)
* [Installing in Air Gap Environments with Embedded Cluster](/enterprise/installing-embedded-air-gap)

### Task 0: Add Custom Domains

<CustomDomains/>

### Task 0: Add Custom License Entitlements

You can add custom license entitlements for your application in the Vendor Portal.

Custom license fields are useful when there is entitlement information that applies to a subset of customers. For example, you can create a custom license field to limit the number of active users permitted. Or, you can create a field that limits the number of nodes a customer is permitted on their cluster.

For more information, see:
* [Managing Custom License Fields](/vendor/licenses-adding-custom-fields)
* [Querying Entitlements with the Replicated SDK API](/vendor/licenses-reference-sdk)
* [Verifying License Field Signatures with the Replicated SDK API](/vendor/licenses-verify-fields-sdk-api)
* [Creating and Managing Customers](/vendor/releases-creating-customer)

## Next Tasks

After completing the main onboarding steps, Replicated recommends that you also complete the following 

### Support Helm CLI Installations

To support Helm CLI installations:

1. In your Helm chart, enable the proxy service for Helm CLI installations by creating a Secret with `type: kubernetes.io/dockerconfigjson` to authenticate with the proxy service. For more information, see [Using the Proxy Service with Helm Installations](/vendor/helm-image-registry).

1. Package your Helm chart and add the archive to a new release.

1. Install the release in a cluster to test your changes. For more information, see [Installing with Helm](/vendor/install-with-helm).

### Configure Backup and Restore

Enable backup and restore with Velero for your application so that users can back up and restore their KOTS Admin Console and application data. 

#### Configure Disaster Recovery for Embedded Cluster Installations

Disaster recovery feature for Embedded Cluster installs

[Disaster Recovery for Embedded Cluster](/vendor/embedded-disaster-recovery)

1. Install the release to test your changes.

#### Configure Snapshots for Existing Cluster KOTS Installations

To Configure Snapshots for Existing Cluster KOTS Installations:

1. [Configuring Backup and Restore](snapshots-configuring-backups)

1. Install the release to test your changes. 

### Customize the Default Support Bundle Spec

You can optionally customize the support bundles for your application by:

* Adding collectors and analyzers
* Editing or excluding the default `clusterInfo` and `clusterResources` collectors

For more information, see [(Optional) Customize the Specification](/vendor/support-bundle-customizing#optional-customize-the-specification) in _Adding and Customizing Support Bundles_.

### Add Custom Metrics

<CustomMetrics/>

### Integrate with CI/CD

<CiCd/>

### Customize Release Channels

<CustomChannels/>