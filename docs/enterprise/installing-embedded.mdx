import Prerequisites from "../partials/install/_ec-prereqs.mdx"

# Online Installation with Embedded Cluster

This topic describes how to install an application in an online (internet-connected) environment with the Replicated Embedded Cluster installer. For information about air gap installations with Embedded Cluster, see [Installing in Air Gap Environments with Embedded Cluster](/enterprise/installing-embedded-air-gap).

## Prerequisites

Before you install, complete the following prerequisites:

<Prerequisites/>

## Install

To install an application with Embedded Cluster:

1. In the [Vendor Portal](https://vendor.replicated.com), go to **Customers** and click on the target customer. Click **Install instructions > Embedded cluster** to open the **Embedded Cluster installation instructions** dialog.

     ![Customer install instructions drop down button](/images/customer-install-instructions-dropdown.png)

     [View a larger version of this image](/images/customer-install-instructions-dropdown.png)

     An **Embedded cluster installation instructions** dialog is displayed.

1. (Optional) In the **Embedded cluster installation instructions** dialog, under **Select a version**, select a specific version to install.

     For example:

     <img alt="Embedded cluster install instruction dialog" src="/images/embedded-cluster-install-dialog.png" width="500px"/>

     [View a larger version of this image](/images/embedded-cluster-install-dialog.png)

1. SSH onto the machine where you will install.

1. Run the first command in the **Embedded cluster install instructions** dialog to download the installation artifacts as a `.tgz`. This includes the Embedded Cluster binary and the customer's license file.

1. Run the second command to extract the `.tgz`.

1. Run the third command to install the release:

    ```bash
    sudo ./APP_SLUG install --license LICENSE_FILE
    ```
    Where:
    * `APP_SLUG` is the unique slug for the application.
    * `LICENSE_FILE` is the customer's license.

1. When prompted, enter a password for accessing the KOTS Admin Console.

     The installation command takes a few minutes to complete.

1. When the installation command completes, go to the URL provided in the output to access the Admin Console.
     
    **Example output:** 

    ```bash
    ✔  Host files materialized
    ? Enter an Admin Console password: ********
    ? Confirm password: ********
    ✔  Host files materialized!
    ✔  Running host preflights
    ✔  Node installation finished!
    ✔  Storage is ready!
    ✔  Embedded Cluster Operator is ready!
    ✔  Admin Console is ready!
    ✔  Additional components are ready!
    Visit the admin console to configure and install gitea-kite: http://104.155.145.60:30000
    ```
    At this point, the cluster is provisioned and the KOTS Admin Console is deployed, but the application is not yet installed.

1. Bypass the browser TLS warning by clicking **Continue to Setup**.

1. Click **Advanced > Proceed**.

1. On the HTTPS page, select **Self-signed** and click **Continue**.

1. On the login page, enter the Admin Console password that you created during installation and click **Log in**.

1. On the **Nodes** page, you can view details about the VM where you installed, including its node role, status, CPU, and memory. Optionally, add nodes before deploying the application. Click **Continue**.

     The Admin Console dashboard opens.

1. In the **Version** section of the dashboard, next to the target version, click **Deploy** then **Yes, Deploy**.

     The application status changes from Missing to Unavailable while the Deployment is being created. When the installation is complete, the status changes to Ready. For example:

     ![Admin console dashboard showing ready status](/images/gitea-ec-ready.png)

     [View a larger version of this image](/images/gitea-ec-ready.png)

## Install Behind a Proxy Server

The following flags can be used with the Embedded Cluster `install` command to install behind a proxy server:

<table>
  <tr>
    <th width="35%">Flag</th>
    <th width="65%">Description</th>
  </tr>
  <tr>
     <td>`--http-proxy`</td>
     <td>Proxy server to use for HTTP</td>
  </tr>
  <tr>
     <td>`--https-proxy`</td>
     <td>Proxy server to use for HTTPS</td>
  </tr>
  <tr>
     <td>`--no-proxy`</td>
     <td>Comma-separated list of hosts for which not to use a proxy</td>
  </tr>
</table>

For multi-node clusters, the proxy settings are automatically configured when joining additional nodes. When deploying the first node of a multi-node cluster, you should pass the node IP addresses (typically in CIDR notation) to `--no-proxy`.

The following are never proxied:
* Internal cluster communication (`localhost`, `127.0.0.1`, `.default`, `.local`, `.svc`, `kubernetes`)
* Communiation to the KOTS database (`kotsadm-rqlite`)
* The CIDR used for assigning IPs to Kubernetes Pods and Services (`10.0.0.0/8`)

### Example

```bash
sudo ./APP_SLUG install --license LICENSE_FILE \
  --http-proxy=HOST:PORT \
  --https-proxy=HOST:PORT \
  --no-proxy=LIST_OF_HOSTS
```

Where:

* `LICENSE_FILE` is the customer's license
* `HOST:PORT` is the host and port of the proxy server
* `LIST_OF_HOSTS` is the list of hosts to not proxy

### Requirement

Proxy installations require Embedded Cluster 1.5.1 or later with Kubernetes 1.29 or later. For example, Embedded Cluster 1.6.0+k8s-1.29 supports installing behind a proxy, and 1.6.0+k8s-1.28 does not. For the latest version information, see the [embedded-cluster](https://github.com/replicatedhq/embedded-cluster/releases) repository in GitHub.

### Limitations

* Proxy settings are not automatically propagated to your [Helm extensions](/reference/embedded-config#helm-extensions) and must be manually configured.
* Proxy settings cannot be changed after installation or during upgrade.

### Set IP Address Ranges for Pods and Services

The following flags can be used with the Embedded Cluster `install` command to allocate IP address ranges for Pods and Services:

<table>
  <tr>
    <th width="35%">Flag</th>
    <th width="65%">Description</th>
  </tr>
  <tr>
     <td>`--pod-cidr`</td>
     <td>The range of IP addresses that can be assigned to Pods, in CIDR notation. By default, the Pod CIDR is 10.96.0.0/12.</td>
  </tr>
  <tr>
     <td>`--service-cidr`</td>
     <td>The range of IP addresses that can be assigned to Services, in CIDR notation. By default, the Service CIDR is 10.244.0.0/16.</td>
  </tr>
</table>


**Example:**

```bash
sudo ./my-app install --license license.yaml --pod-cidr 172.16.136.0/16
```

**Limitation:**

The `--pod-cidr` and `--service-cidr` flags are not supported on Red Hat Enterprise Linux (RHEL) 9 operating systems.